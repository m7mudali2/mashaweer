workflows:
  Build App:
    name: Build Mashaweer for Android and iOS
    environment:
      vars:
        BUNDLE_ID: "online.mashaweer"
        APP_NAME: "Mashaweer App"
      groups:
        - Appstore
      node: 18.16.0
      xcode: 15.2
      cocoapods: default
      flutter: stable

scripts:
  - name: Install dependencies
    script: |
      npm install
      npm rebuild esbuild
  - name: Build Web App
    script: |
      chmod +x ./node_modules/.bin/vite || true
      npm run build


      - name: Sync Capacitor
        script: |
          npx cap sync

      - name: Build Android
        script: |
          cd android
          ./gradlew bundleRelease

      - name: Build iOS
        script: |
          cd ios
          xcodebuild -workspace App/App.xcworkspace -scheme App -configuration Release -sdk iphoneos -derivedDataPath build

    artifacts:
      - android/app/build/outputs/**/*.aab
      - ios/build/Build/Products/Release-iphoneos/*.app
      - build/**/outputs/**/*.apk

publishing:
  app_store_connect:
    authentication: integration
    name: mashaweer
    submit_to_testflight: true
    submit_to_app_store: false

